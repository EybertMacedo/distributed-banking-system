<!–– account-management/public/index.html ––>
<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accounts Management</title>
  <style>
    .container {
  border-bottom-left-radius: 10px;
  border-bottom-right-radius: 10px;
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
  padding-left: 30px;
  padding-right: 30px;
  padding-top: 20px;
  background-color: white;
  height: 100%;
}
.header {
  text-align: center;
  background-color: #8cadb0;
  color: #513d3d;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
  margin-left: auto;
  margin-right: auto;
  padding-left: 30px;
  padding-right: 30px;
  padding-top: 10px;
  padding-bottom: 10px;
}

body {
  font-family: 'Merriweather', sans-serif;
  background-color: rgb(140, 43, 52);
}
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 20px;
}
tr {
  background-color: #f2f2f2;
}
th, td {
  border: 1px outset #ddd;
  padding: 8px;
  text-align: left;
}
th {
  background-color: #6f7b7c;
  letter-spacing: 0.03em;
  color: #ffffff;
}

input {
  font-family: 'Merriweather', sans-serif;
  position: relative;
  margin: auto;
  border-radius: 1px;
  overflow: hidden;
  padding-top: 5px;
  padding-bottom: 5px;
}

button {    
  border-radius: 3px;
  box-sizing: border-box;
  cursor: pointer;
  display: inline-block;
  font-family: -apple-system,system-ui,"Segoe UI","Liberation Sans",sans-serif;
  font-size: 13px;
  font-weight: 400;
  line-height: 1;
  margin: 0;
  outline: none;
  padding: 8px .8em;
  position: relative;
  text-align: center;
  text-decoration: none;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  vertical-align: baseline;
  white-space: nowrap;
  }

.button-green {
  background-color: #e5f4e1;
  border: 1px outset #707c6f;
  box-shadow: rgba(255, 255, 255, .7) 0 1px 0 0 inset;  
  color: #4a9d39;
}

.button-green:hover,
.button-green:focus {
  background-color: #bddfb4;
  color: #094f60;
}

.button-green:focus {
  box-shadow: 0 0 0 4px rgba(0, 149, 255, .15);
}

.button-green:active {
  background-color: #7ab2d8;
  box-shadow: none;
  color: #2f772c;
}    
.button-blue {
  background-color: #e1ecf4;
  border: 1px outset #6f7b7c;
  box-shadow: rgba(255, 255, 255, .7) 0 1px 0 0 inset;  
  color: #39739d;
}

.button-blue:hover,
.button-blue:focus {
  background-color: #b4dcdf;
  color: #146009;
}

.button-blue:focus {
  box-shadow: 0 0 0 4px rgba(0, 149, 255, .15);
}

.button-blue:active {
  background-color: #7ad8b9;
  box-shadow: none;
  color: #2c5777;
}
.button-red {
  background-color: #f4e1e1;
  border: 1px outset #7c6f6f;
  box-shadow: rgba(255, 255, 255, .7) 0 1px 0 0 inset;  
  color: #9d3939;
}

.button-red:hover,
.button-red:focus {
  background-color: #dfb4b4;
  color: #600909;
}

.button-red:focus {
  box-shadow: 0 0 0 4px rgba(0, 149, 255, .15);
}

.button-red:active {
  background-color: #d87a7a;
  box-shadow: none;
  color: #772c2c;
}

  </style>
</head>

<body>
  <div class="header">
    <h1>Distributed Banking System</h1>
  </div>
  <div class="container">   
    <h2>User Management</h2>

    <h3>Create New Account:</h3>
    <form id="create-account-form">
      <label for="clientId">Client ID:</label>
      <input type="number" id="clientId" name="clientId" required>
      <label for="bankId">Bank ID:</label>
      <input type="number" id="bankId" name="bankId" required>
      <label for="balance">Balance:</label>
      <input type="number" id="balance" name="balance" step="0.01" required>
      <button class="button-green" role="button" type="submit">Create Account</button>
    </form>

    <h3>Accounts:</h3>
    <table id="accounts-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Client ID</th>
          <th>Billetera</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody id="accounts-list"></tbody>
    </table>

    <h3>Update Account:</h3>
    <form id="update-account-form">
      <label for="updateAccountId">Account ID:</label>
      <input type="number" id="updateAccountId" name="updateAccountId" required>
      <label for="updateClientId">New Client ID:</label>
      <input type="number" id="updateClientId" name="updateClientId">
      <label for="updateBankId">New Bank ID:</label>
      <input type="number" id="updateBankId" name="updateBankId">
      <label for="updateBalance">New Balance:</label>
      <input type="number" id="updateBalance" name="updateBalance" step="0.01">
      <button class="button-green" role="button" type="submit">Update Account</button>
    </form>

    <h3>Delete Account:</h3>
    <form id="delete-account-form">
      <label for="deleteAccountId">Account ID:</label>
      <input type="number" id="deleteAccountId" name="deleteAccountId" required>
      <button class="button-red" role="button" type="submit">Delete Account</button>
    </form>
  </div>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
// account-management/public/app.js
document.addEventListener('DOMContentLoaded', async () => {
  // Fetch and display accounts
  const currentUrl = window.location.href;
  console.log(currentUrl);
  const accounts = await fetchAccounts(currentUrl);
  displayAccounts(accounts);

  // Set up form submission
  const createAccountForm = document.getElementById('create-account-form');
  createAccountForm.addEventListener('submit', async (event) => {
    event.preventDefault();
    const clientId = document.getElementById('clientId').value;
    const bankId = document.getElementById('bankId').value;
    const balance = document.getElementById('balance').value;
    await createAccount(clientId, bankId, balance);
    // Refresh accounts list after creating a new account
    const updatedAccounts = await fetchAccounts(currentUrl);
    displayAccounts(updatedAccounts);
  });
});

async function fetchAccounts(url) {  
  try {
    let apiUrl;

    if (url.includes('/banks/')) {
      // If the URL contains '/banks/', fetch accounts based on bank ID
      const bankId = url.split('/banks/')[1];
      apiUrl = `http://localhost:3002/banks/${bankId}`;
    } else if (url.includes('/clients/')) {
      // If the URL contains '/clients/', fetch accounts based on client ID
      const clientId = url.split('/clients/')[1];
      apiUrl = `http://localhost:3002/clients/${clientId}`;
    } else {
      apiUrl = 'http://localhost:3002/accounts';
    }

    const response = await axios.get(apiUrl);
    return response.data;
  } catch (error) {
    console.error('Error fetching accounts:', error);
  }  
}



async function createAccount(clientId, bankId, balance) {
  try {
    await axios.post('http://localhost:3002/accounts', { clientId, bankId, balance });
  } catch (error) {
    console.error('Error creating account:', error);
  }
}

async function updateClient(newClientId, newBankId, newBalance) {
  try {
    await axios.put(`http://localhost:3002/accounts/${accountId}`, { client_id: newClientId, bank_id: newBankId, balance: newBalance });
  } catch (error) {
    console.error('Error updating client:', error);
  }
}

async function deleteAccount(accountId) {
  try {
    await axios.delete(`http://localhost:3002/accounts/${accountId}`);
  } catch (error) {
    console.error('Error deleting client:', error);
  }
}

const deleteAccountForm = document.getElementById('delete-account-form');
deleteAccountForm.addEventListener('submit', async (event) => {
  event.preventDefault();
  const accountId = document.getElementById('deleteAccountId').value;
  await deleteAccount(accountId);
  // Refresh account list after deleting an account
  const updatedAccountsAfterDelete = await fetchAccounts();
  displayAccounts(updatedAccountsAfterDelete);
});

function displayAccounts(accounts) {
  console.log('Displaying accounts:', accounts);

  const accountsTable = document.getElementById('accounts-table');
  const accountsList = document.getElementById('accounts-list');
  accountsList.innerHTML = '';

  accounts.forEach((account) => {
    const row = accountsTable.insertRow(-1);
    const cellId = row.insertCell(0);
    const cellClientId = row.insertCell(1);
    const cellBankId = row.insertCell(2);
    const cellBalance = row.insertCell(3);

    cellId.textContent = account.id;
    cellClientId.textContent = account.client_id;
    cellBankId.textContent = account.bank_id;
    cellBalance.textContent = account.balance;
  });     
}



  </script>
</body>
</html>
